---
title: "Replication of Study by Shavit et al. (2022, Work, Aging, and Retirement)"
author: "Enna Chen (ennachen@stanford.edu)"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: false
---

<!-- Replication reports should all use this template to standardize reporting across projects.  These reports will be public supplementary materials that accompany the summary report(s) of the aggregate results. -->

## Introduction

### The original study

This study examined how time horizon (unspecified or expanded) influence the motivation (demonstrated by choice from three work-related activities) of older and younger workers (age measured as a continuous variable).

### Justification

This paper is the latest publication (July 2022) from my lab that I am really intrigued by. It is along my line of research -- age, motivation, and prosociality. Additionally, it has a similar type of design as my intended first-year project (also potentially a life-span sample divided into three experimental conditions). I have never conducted a study with this type of design, so I hope to use this class project to practice for my own data collection and analysis. 

### Stimuli, procedures, challenges

Participants will be randomly assigned to one of two experimental conditions where time horizons at work were unspecified or expanded. Each condition includes a brief manipulation prompt, which had been validated in the original study. After reading the prompt, we ask participants in each condition to choose one of three work-related activities, each of which represent pursuit of a different type of goal. In the end, participants will provide information on their age, gender, and subjective socioeconomical status.

This Qualtrics survey would take approximately 2 minutes. The original paper has a sample of 555 adults aged 20 to 75 (M = 44.65, SD = 13.2). I will recruit a sample of 170 participants that matches with this age distribution by creating age buckets on Prolific. I will recruit only people who have a full-time. 

### Links

[Link to my repo](https://github.com/psych251/shavit2022)
[Link to the original paper](https://github.com/psych251/shavit2022/blob/main/original_paper/original_paper.pdf)

## Methods

### Power Analysis 

Original effect size: -.42
Effect sizes to achieve 80%, 90%, 95% power: 170, 232, 291
Considering our class funding, I decided to go with the 170 sample size that will achieve 80% power.

### Planned Sample

We will recruit 170 participants relatively evenly distributed from ages 20-75. In the paper, it was 20 to 75 years with a mean of 44.65, and SD of 13.2, and it was similar across conditions. They will all be full-time employees.

### Materials + Procedure

Participants were randomly assigned to one of two experimental conditions where time horizons at work were either unspecified or expanded. In the unspecified condition, participants were asked to imagine that they arrived at work one day and found that they had unscheduled time. Participants in the expanded time horizons condition were told that “the company would like you to stay with them considerably longer than you had planned.”

After reading the prompt, participants in each condition were asked to choose one of three work-related activities that they would pursue: “Help a colleague or a friend with a company project,” “Work on a project that may help you advance you career,” or “Work on a project that may lead the company in a new direction.” Helping colleagues represented pursuit of emotionally meaningful goals, whereas career-advancing and taking the company in new directions represented pursuit of exploratory goals (future payoffs and learning new information, respectively).

Finally, participants will provide background information - age, gender, subjective socioeconomic status, and employment status.

I have obtained the original questionnaire materials from the author.
[Link to my questionnaire](https://stanforduniversity.qualtrics.com/jfe/form/SV_0Utk18jvCwCk61w)

### Analysis Plan

**Clarify key analysis of interest here. You can also pre-specify additional analyses you plan to do.**  

The original paper did not mention data cleaning or exclusion rules. I would double check participants' answers to the age and employment status questions in Qualtrics to make sure to exclude those who are not 20-75 or full-time employees, in case the exclusion requirement from Prolific was not accurate.

The original paper included many covariates (e.g., Big Five Personality, Future Time Perspective, etc.). To be mindful of our class funding, I will only include basic demographic information (age, gender, employment status, and subjective socioeconomic status) as covariates.

Below are my three proposed statistical tests:

Key test:
1. The main test focuses on the difference (across ages) in the likelihood of choosing to help colleagues between the unspecified and the expanded time horizon conditions. I will use logistic regression to look at how the likelihood of deciding to help others (vs. exploratory goals) is associated with z-scored age, condition (unspecified vs. expanded time horizons), and their interaction. I will use two logistic regression models, one to set the unspecified time horizon condition as the reference group, and the other one to set the expanded time horizon condition as the reference group. Whether the replication is successful will be determined by whether there is an interaction effect of condition and age.

Exploratory tests:
1. Hypothesis 1 states that when time horizons are unspecified, older age is associated with a preference to help others over future-oriented options. Our first exploratory test focuses on the simple effect of age on the likelihood of choosing to help a colleague or a friend over any of the future-oriented options in the unspecified time horizon condition.
2. Hypothesis 2 states that when time horizons are expanded, age differences in work preferences are eliminated such that across all ages, future oriented options are preferred over helping others. Our second exploratory test focuses on the simple effect of age on the likelihood of choosing to help a colleague or a friend over any of the future-oriented options in the expanded time horizon condition.

### Differences from Original Study

The focal tests of the original paper for the three hypotheses are the simple effects of age on the likelihood of choosing to help a colleague or a friend over any of the future-oriented options, in each of the three conditions. Note that in this replication study, we only included two of the three conditions that had the largest effect. 

The original paper estimated the effects of age and time horizons condition using logistic regressions in which the intercept indicates a difference from a chance level of 33%. Although they did not expect to find significant Age x Condition interactions because they were not found in past research, they included them in the model to provide context for understanding the focal tests of age associations with preferences in each of the conditions. 

As a first step, they entered only age, condition, and their interaction term into the model. In a second step, to ensure any observed age effects are not caused by third variables, they included background variables found to be significantly associated with age in the current sample as control variables. To facilitate interpretation, they supplemented this approach with chi-square analysis. Because the results did not change after including the control variables, and that none of the covariates are theoretically necessary in this replication study, we will focus on the first step, and include fewer background variables for the second step. 

### Methods Addendum (Post Data Collection) --- TO BE COMPLETED

You can comment this section out prior to final report with data collection.

#### Actual Sample --- TO BE COMPLETED
  Sample size, demographics, data exclusions based on rules spelled out in analysis plan

#### Differences from pre-data collection methods plan --- TO BE COMPLETED
  Any differences from what was described as the original plan, or “none”.

## Results

### Data preparation
	
```{r Data preparation}

###Data Preparation

####Load Relevant Libraries and Functions

library(tidyverse)
library(knitr)
library(MASS)
library(nnet)
library(haven)
library(car)
library(psych)
library(RColorBrewer)
library(ggsignif)
library(DescTools)
library(rcompanion)
library(dplyr)

#### Import data

# Load and clean data
setwd("~/Downloads/Psych251/FinalProject/shavit2022/writeup")
psych251data <- read.csv("psych251data.csv", header = TRUE)
#View(psych251data)
names(psych251data)

#### Data exclusion / filtering

psych251data <- psych251data[-c(1:2),] # Remove first two rows
psych251data <- psych251data %>% dplyr::select(ResponseId, Unspecified, Expanded, Age, Gender, Employment, SESLadder) # Select relevant variables (deleting metadata)

# Make sure all data are in an appropriate format 
psych251data$Unspecified <- as.numeric(psych251data$Unspecified)
psych251data$Expanded <- as.numeric(psych251data$Expanded)
psych251data$Age <- as.numeric(psych251data$Age)
psych251data$Gender <- factor(psych251data$Gender)
psych251data$Employment <- factor(psych251data$Employment)
psych251data$SESLadder <- as.numeric(psych251data$SESLadder)

psych251data <- psych251data %>% filter(Employment=="1") %>% filter(Age >= 20 & Age <= 75) # We only want people aged 20-75 who are full-time paid employees.
summary(psych251data$Age)
summary(psych251data$Employment)

#### Prepare data for analysis - create columns etc.

# Take a look at the data
psych251data <- as.data.frame(psych251data)

# Create a condition column to specify which condition each person is assigned to 
psych251data <- psych251data %>%
  mutate(Condition = case_when(
    Expanded == 1 | Expanded == 2 | Expanded == 3 ~ "Expanded",
    Unspecified == 1 | Unspecified == 2 | Unspecified == 3 ~ "Unspecified"))

# Combine participants' answers to time horizon questions into one column called Choice
psych251data <- gather(psych251data, "Condition", "Choice", c("Unspecified", "Expanded")) %>% filter(!is.na(Choice))

# Make sure choice and condition are factors 
psych251data$Choice <- as.factor(psych251data$Choice)
psych251data$Choice <- dplyr::recode(psych251data$Choice, '1' = "colleague/friend", '2' = "new direction", '3' = "advance career")
psych251data$Condition=as.factor(psych251data$Condition)
levels(psych251data$Condition)=c("Unspecified", "Expanded")

# Is there sig diff between the number of people in each condition
conditiontable=table(psych251data$Condition)
t.test(conditiontable)

# Age, gender, SES diff across conditions
summary(lm(data = psych251data, Age~Condition))
summary(table(psych251data$Gender,psych251data$Condition))
summary(lm(data = psych251data, SESLadder~Condition))

```

### Confirmatory analysis

The analyses as specified in the analysis plan.  

```{r Confirmatory analysis}

# Create binary variable (that indicates whether the participants choose to help others or not) for logistic regression
psych251data$Help <- recode (psych251data$Choice, "'colleague/friend'=1; 'advance career'=0; 'new direction'=0; else=NA", as.factor = F, as.numeric = T)

# Main analyses: logistic regression - difference between control and expanded time horizon conditions

# Set offset to reflect that chance success is 33%
p_help=0.333
log_odds_help = log(p_help/(1-p_help))
log_odds_help

# Difference between conditions (age by condition) with no control variables
psych251data$Condition <- relevel(psych251data$Condition, ref="Unspecified")
glm_diff_unspec <- glm(data = psych251data, Help~scale(Age)*Condition, family = "binomial", offset = rep(log_odds_help, length(psych251data$ResponseId)))
summary(glm_diff_unspec) 

psych251data$Condition <- relevel(psych251data$Condition, ref="Expanded")
glm_diff_expand <- glm(data = psych251data, Help~scale(Age)*Condition, family = "binomial", offset = rep(log_odds_help, length(psych251data$ResponseId)))
summary(glm_diff_expand) 

# Difference between conditions (age by condition) with control variables (gender + SES)
psych251data$Condition <- relevel(psych251data$Condition, ref="Unspecified")
glm_diff_unspec_ctl <- glm(data = psych251data, Help~scale(Age)*Condition + scale(SESLadder), family = "binomial", offset = rep(log_odds_help, length(psych251data$ResponseId)))
summary(glm_diff_unspec_ctl) 

psych251data$Condition <- relevel(psych251data$Condition, ref="Expanded")
glm_diff_expand_ctl <- glm(data = psych251data, Help~scale(Age)*Condition + scale(SESLadder), family = "binomial", offset = rep(log_odds_help, length(psych251data$ResponseId)))
summary(glm_diff_expand_ctl) 

```

*Side-by-side graph with original graph is ideal here*

For original graph, see Figure 1 in the original paper: https://github.com/psych251/shavit2022/blob/main/original_paper/original_paper.pdf

Note that in this replication study, we only have unspecified time horizon condition and expanded time horizon condition. We did not include the limited time horizon condition.

```{r Graphs}

psych251data$Condition <- relevel(psych251data$Condition, ref="Unspecified")
psych251data$Condition_Order <- as.factor(psych251data$Condition)
levels(psych251data$Condition_Order) <- c("Unspecified", "Expanded time")
levels(psych251data$Condition_Order)
table(psych251data$Condition_Order)

ggplot(data=psych251data, aes(x=Age, y=Help)) +
  geom_point(alpha=0.2, position = position_jitter(height = 0.03)) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), color="black") +
  geom_hline(yintercept = 0.33, linetype="dashed") +
  ggthemes::theme_few()+labs(y="Likelihood of choosing\n'Help friend / colleague'", x="Age") +
  facet_grid(.~Condition_Order)

```

### Exploratory analyses

```{r Exploratory analyses}

# Exploratory analyses: logistic regression - within control or within expanded time horizon conditions

# Within unspecified condition with no control variables

psych251data_unspec <- psych251data %>% filter(Condition=="Unspecified")
glm_unspec <- glm(data = psych251data_unspec, Help~scale(Age), family = "binomial", offset = rep(log_odds_help, length(psych251data_unspec$ResponseId)))
summary(glm_unspec)

# Within expanded condition with no control variables

psych251data_expand <- psych251data %>% filter(Condition=="Expanded")
glm_expand <- glm(data = psych251data_expand, Help~scale(Age), family = "binomial", offset = rep(log_odds_help, length(psych251data_expand$ResponseId)))
summary(glm_expand)

# Within unspecified condition with control variable: SES

psych251data_unspec <- psych251data %>% filter(Condition=="Unspecified")
glm_unspec_ctl <- glm(data = psych251data_unspec, Help~scale(Age) + scale(SESLadder), family = "binomial", offset = rep(log_odds_help, length(psych251data_unspec$ResponseId)))
summary(glm_unspec_ctl)

# Within expanded condition with control variable: SES

psych251data_expand <- psych251data %>% filter(Condition=="Expanded")
glm_expand_ctl <- glm(data = psych251data_expand, Help~scale(Age) + scale(SESLadder), family = "binomial", offset = rep(log_odds_help, length(psych251data_expand$ResponseId)))
summary(glm_expand_ctl)

```

## Discussion --- TO BE COMPLETED

### Summary of Replication Attempt --- TO BE COMPLETED

Open the discussion section with a paragraph summarizing the primary result from the confirmatory analysis and the assessment of whether it replicated, partially replicated, or failed to replicate the original result.  

### Commentary --- TO BE COMPLETED

Add open-ended commentary (if any) reflecting (a) insights from follow-up exploratory analysis, (b) assessment of the meaning of the replication (or not) - e.g., for a failure to replicate, are the differences between original and present study ones that definitely, plausibly, or are unlikely to have been moderators of the result, and (c) discussion of any objections or challenges raised by the current and original authors about the replication attempt.  None of these need to be long.
